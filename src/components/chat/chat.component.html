<div class="h-full flex flex-col text-sm">
  <!-- Message display area -->
  <div class="flex-1 overflow-y-auto p-4 space-y-4">
    @for (message of messages(); track $index) {
      @if (message.role === 'user') {
        <div class="flex items-start justify-end">
          <div class="max-w-xs md:max-w-md lg:max-w-lg px-4 py-2 rounded-lg bg-[rgb(var(--color-accent-solid-bg))] text-[rgb(var(--color-text-inverted))]">
            <p class="whitespace-pre-wrap">{{ message.text }}</p>
          </div>
        </div>
      } @else {
        <div class="flex items-start">
          <div class="max-w-xs md:max-w-md lg:max-w-lg px-4 py-2 rounded-lg bg-[rgb(var(--color-surface-muted))] dark:bg-[rgb(var(--color-surface))]">
            <p class="whitespace-pre-wrap">{{ message.text }}@if(isLoading() && $last){<span class="inline-block w-2 h-4 bg-[rgb(var(--color-text-base))] animate-pulse ml-1 align-middle"></span>}</p>
          </div>
        </div>
      }
    }
  </div>

  <!-- Input area -->
  <div class="p-4 border-t border-[rgb(var(--color-border-base))] bg-[rgb(var(--color-surface))]">
    <div class="flex items-center space-x-2">
      <textarea 
        [value]="newMessage()"
        (input)="onInput($event)"
        (keydown.enter)="$event.preventDefault(); sendMessage()"
        [disabled]="isLoading() || !isApiKeyAvailable()"
        placeholder="{{ isApiKeyAvailable() ? 'Type your message...' : 'API key not configured' }}"
        rows="1"
        class="flex-1 p-2 bg-transparent border border-[rgb(var(--color-border-muted))] rounded-md resize-none focus:outline-none focus:ring-1 focus:ring-[rgb(var(--color-accent-ring))] disabled:bg-[rgb(var(--color-surface-muted))] disabled:cursor-not-allowed"></textarea>
      <button 
        (click)="sendMessage()" 
        [disabled]="!newMessage().trim() || isLoading() || !isApiKeyAvailable()"
        class="p-2 rounded-md bg-[rgb(var(--color-accent-solid-bg))] text-[rgb(var(--color-text-inverted))] hover:bg-[rgb(var(--color-accent-solid-bg-hover))] disabled:bg-[rgb(var(--color-disabled-bg))] disabled:cursor-not-allowed transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
        </svg>
      </button>
    </div>
    @if (!isApiKeyAvailable()) {
        <p class="text-xs text-center text-[rgb(var(--color-text-subtle))] mt-2">
            A Gemini API key has not been configured. Chat is disabled.
        </p>
    }
  </div>
</div>