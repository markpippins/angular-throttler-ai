<div class="h-full flex flex-col bg-[rgb(var(--color-surface))]">
  <!-- Toolbar -->
  <div class="flex-shrink-0 flex items-center p-2 border-b border-[rgb(var(--color-border-base))] bg-[rgb(var(--color-surface-muted))] text-sm">
    <div class="flex items-center rounded-md bg-[rgb(var(--color-surface))] p-0.5 border border-[rgb(var(--color-border-muted))]">
      <button 
        (click)="mode.set('edit')" 
        title="Edit"
        class="p-1.5 rounded-sm transition-colors"
        [class.bg-[rgb(var(--color-accent-solid-bg))]]="mode() === 'edit'"
        [class.text-white]="mode() === 'edit'"
        [class.text-[rgb(var(--color-text-muted))]]="mode() !== 'edit'"
        [class.hover:bg-[rgb(var(--color-surface-hover))]]="mode() !== 'edit'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
          <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
        </svg>
      </button>
      <button 
        (click)="mode.set('preview')" 
        title="Preview"
        class="p-1.5 rounded-sm transition-colors"
        [class.bg-[rgb(var(--color-accent-solid-bg))]]="mode() === 'preview'"
        [class.text-white]="mode() === 'preview'"
        [class.text-[rgb(var(--color-text-muted))]]="mode() !== 'preview'"
        [class.hover:bg-[rgb(var(--color-surface-hover))]]="mode() !== 'preview'">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
          <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>
  </div>

  @if (mode() === 'edit') {
    <textarea 
      [value]="noteContent()"
      (input)="onInput($event)"
      placeholder="Start typing your notes..."
      class="w-full h-full p-3 bg-transparent border-0 resize-none focus:outline-none text-sm text-[rgb(var(--color-text-base))] font-mono">
    </textarea>
  } @else {
    <div 
      class="prose prose-sm max-w-none p-3 overflow-y-auto"
      [innerHTML]="renderedHtml()">
    </div>
  }
</div>
